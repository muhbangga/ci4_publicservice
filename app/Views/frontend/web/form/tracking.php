<?= $this->extend('frontend/theme/template'); ?>
<?= $this->section('content'); ?>
<section class="faq-9 faq section light-background" id="" style="padding-top: 150px">

  <div class=" container">
    <div class="row">

      <div class="col-lg-5" data-aos="fade-up">
        <h2 class="faq-title">Lacak Permohonan</h2>
        <div class="faq-arrow d-none d-lg-block" data-aos="fade-up" data-aos-delay="200">
          <svg xmlns="http://www.w3.org/2000/svg" data-name="Layer 1" width="450" height="411" viewBox="0 0 863.41339 594.50334" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M210.45783,717.83874c-14.53694,10.27106-19.05685,28.8792-19.05685,28.8792s19.04911,1.95548,33.58605-8.3156,19.05685-28.8792,19.05685-28.8792S224.99478,707.56771,210.45783,717.83874Z" transform="translate(-168.29331 -152.74833)" fill="#f2f2f2" />
            <path d="M216.27318,722.9831c-7.27473,16.24487-24.66192,24.26857-24.66192,24.26857s-5.59248-18.3144,1.68226-34.55926,24.66187-24.26857,24.66187-24.26857S223.54791,706.73824,216.27318,722.9831Z" transform="translate(-168.29331 -152.74833)" fill="#f2f2f2" />
            <rect x="399.32024" y="0.2631" width="464.09314" height="297.2259" fill="#e5e5e5" />
            <rect x="412.59088" y="37.54264" width="437.55191" height="113.30501" fill="#fff" />
            <rect x="412.59088" y="166.58445" width="437.55191" height="113.30501" fill="#017e3a" />
            <rect x="399.12208" width="464.09315" height="19.71638" fill="#3f3d56" />
            <circle cx="413.7737" cy="10.08006" r="3.65428" fill="#fff" />
            <circle cx="427.64443" cy="10.08006" r="3.65428" fill="#fff" />
            <circle cx="441.51516" cy="10.08006" r="3.65428" fill="#fff" />
            <rect x="566.42449" y="73.15076" width="146.29193" height="6.91668" fill="#cbcbcb" />
            <rect x="566.42449" y="91.13411" width="146.29193" height="6.91668" fill="#cbcbcb" />
            <rect x="566.42449" y="109.11747" width="146.29193" height="6.91668" fill="#cbcbcb" />
            <circle cx="554.53121" cy="76.87011" r="4.51397" fill="#cbcbcb" />
            <rect x="558.22087" y="201.79526" width="146.29193" height="6.91668" fill="#fff" />
            <rect x="558.22087" y="219.77861" width="146.29193" height="6.91668" fill="#fff" />
            <rect x="558.22087" y="237.76197" width="146.29193" height="6.91668" fill="#fff" />
            <circle cx="536.91844" cy="204.18202" r="4.51397" fill="#fff" />
            <path d="M370.4313,506.48113l-14.34912-64.57172-3.26709-24.89294-24.271,2.02252,2.48925,34.69458L356.508,512.71105a10.99976,10.99976,0,1,0,13.92334-6.22992Z" transform="translate(-168.29331 -152.74833)" fill="#9f616a" />
            <polygon points="237.4 581.782 249.659 581.782 255.492 534.494 237.397 534.495 237.4 581.782" fill="#9f616a" />
            <path d="M402.56563,730.528l24.144-.001h.001a15.3873,15.3873,0,0,1,15.38647,15.38623v.5l-39.53076.00147Z" transform="translate(-168.29331 -152.74833)" fill="#2f2e41" />
            <polygon points="137.175 572.735 149.014 575.919 166.931 531.77 149.457 527.07 137.175 572.735" fill="#9f616a" />
            <path d="M303.48809,720.8052l23.31536,6.27127.00094.00025a15.38729,15.38729,0,0,1,10.86113,18.85512l-.12989.48284-38.17393-10.268Z" transform="translate(-168.29331 -152.74833)" fill="#2f2e41" />
            <path d="M425.313,527.23383l5.43483,9.40127s5.97177,1.63112,4.02008,21.0977-11.628,67.62682-11.628,67.62682,9.59218,67.174.14512,81.36615l-1.70918,12.18705-17.83956,1.70477-.44982-10.81355s-12.90624-49.68326-10.66569-71.39811L382.015,559.56986s-22.50328,57.63582-29.40858,68.56623c0,0-11.536,67.07569-21.89975,70.68446l-3.74288,12.28726-18.781-2.73068,3.39724-14.11s.18516-65.912,15.51628-84.77869l11.84624-83.77832Z" transform="translate(-168.29331 -152.74833)" fill="#2f2e41" />
            <path d="M395.30362,540.9016c-8.33155,0-16.07154-1.22656-20.59009-4.895-6.55591-5.32226-14.91321-4.1958-22.28662-3.20166-7.38623.99561-13.76526,1.855-16.14575-4.18066l-.042-.10645.00843-.11426,7.35547-98.562-9.7638-34.08105.02454-.12012c.03479-.16992,3.65613-17.04248,19.59143-25.00977l21.47827-9.85986,34.82324,2.86817,21.846,17.31152v.2417l.06152,154.62988-.376.09668C430.12491,536.217,411.58536,540.9016,395.30362,540.9016Z" transform="translate(-168.29331 -152.74833)" fill="#cbcbcb" />
            <path d="M348.61172,428.78978l-22.40649-7.16406,8.13721-28.34814,11.57836,1.27685Z" transform="translate(-168.29331 -152.74833)" fill="#cbcbcb" />
            <path d="M453.4313,522.48113l-14.34912-64.57172-3.26709-24.89294-24.271,2.02252,2.48925,34.69458L439.508,528.71105a10.99976,10.99976,0,1,0,13.92334-6.22992Z" transform="translate(-168.29331 -152.74833)" fill="#9f616a" />
            <path d="M408.20425,439.22l-1.906-25.416,24.14624-33.4746.24462-.00831c.09961-.00537,9.812-.17334,11.56128,14.70557,1.70533,14.5044-3.509,41.47559-3.562,41.74609l-.07348.377Z" transform="translate(-168.29331 -152.74833)" fill="#cbcbcb" />
            <circle cx="395.37087" cy="331.10476" r="22.79337" transform="translate(-216.22516 -85.14155) rotate(-9.21747)" fill="#9f616a" />
            <path d="M416.20891,327.72112s.18248-8.013,1.1956-11.55868,3.03911-6.58475,2.0261-6.58475-1.51956-2.5326-1.51956-2.5326-1.013-.50651-1.51956,0-1.013-3.54562-1.013-3.54562-.50653-1.51955-1.013-.50651-.50654.50651-1.013-1.013-3.03927-2.53261-3.03927-2.53261-9.62386.50651-11.14342-1.51956-18.7412-.50652-22.28684,2.02607-19.24774,11.64994-16.71511,19.24773,9.823,25.09158,11.65,26.84552c2.88893,2.77348,4.88893,3.77348,18.55866,6.49349,2.67524.53232,16.33027-8.20046,16.33027-9.72s-1.64622-6.33845,1-7c4-1,4.45,4.057,5.46306,2.53748S416.20891,327.72112,416.20891,327.72112Z" transform="translate(-168.29331 -152.74833)" fill="#2f2e41" />
            <path d="M550.29331,746.82055h-381a1,1,0,0,1,0-2h381a1,1,0,0,1,0,2Z" transform="translate(-168.29331 -152.74833)" fill="#cbcbcb" />
          </svg>

        </div>
      </div>

      <div class="col-lg-7" data-aos="fade-up" data-aos-delay="300">
        <div class="faq-container">
          <div class="card">
            <div class="card-body">
              <form method="post" action="<?= base_url('beranda/search') ?>">
                <?= csrf_field() ?>
                <label for="e_tiket">E-Tiket:</label>
                <input type="text" class="form-control" name="e_tiket" id="e_tiket" value="<?= isset($e_tiket) ? esc($e_tiket) : '' ?>">

                <label for="no_handphone">No Handphone:</label>
                <input type="text" class="form-control" name="no_handphone" id="no_handphone" value="<?= isset($no_handphone) ? esc($no_handphone) : '' ?>">
                <br>

                <button type="submit" class="btn btn-success btn-sm"><i class="fa fa-search"></i> Cari</button>
              </form>
              <br>

              <?php if (isset($results)): ?>
                <div class="card">
                  <div class="card-body">
                    <h5>Hasil Pencarian:</h5>
                    <?php if (count($results) > 0): ?>
                      <table class="table">
                        <tbody>
                          <?php foreach ($results as $key => $value): ?>
                            <tr>
                              <td width="22%">Nama Lengkap</td>
                              <td>: <?= esc($value['nama_lengkap']) ?></td>
                            </tr>
                            <tr>
                              <td>E-Tiket</td>
                              <td>: <?= esc($value['e_tiket']) ?></td>
                            </tr>
                            <tr>
                              <td>No. HP</td>
                              <td>: <?= esc($value['no_handphone']) ?></td>
                            </tr>
                            <tr>
                              <td>Layanan</td>
                              <td>: <?= esc($value['nama_layanan']) ?></td>
                            </tr>
                            <tr>
                              <td>Status</td>
                              <td>:

                                <div class="timeline">
                                  <?php
                                  $statuses = [
                                    0 => ["Menunggu Konfirmasi Petugas", "bg-secondary", "fa-hourglass-half"],
                                    1 => ["Diterima PTSP", "bg-warning", "fa-user-tie"],
                                    2 => ["Diproses Unit Pengelola", "bg-info", "fa-user-clock"],
                                    3 => ["Berkas Selesai", "bg-success", "fa-clipboard-check"],
                                  ];

                                  foreach ($statuses as $key => $status) {
                                    $isActive = ($value['status'] >= $key) ? "" : "nonactive";
                                  ?>
                                    <div class="timeline-item right <?php echo $isActive; ?>">
                                      <div class="timeline-content">
                                        <h3>
                                          <i class="fas <?php echo $status[2]; ?> icon"></i>
                                          <span class="badge <?php echo $status[1]; ?> badge-xl"><?php echo $status[0]; ?></span>
                                        </h3>
                                        <p>
                                          <?php
                                          if ($key == 0) {
                                            echo "Berkas masih menunggu konfirmasi dari petugas.";
                                          } elseif ($key == 1) {
                                            echo "Berkas telah diterima oleh PTSP dan sedang dalam proses verifikasi awal.";
                                          } elseif ($key == 2) {
                                            echo "Berkas sedang dalam proses verifikasi oleh unit pengelola terkait.";
                                          } else {
                                            echo "Berkas telah selesai diproses dan siap untuk diunduh.";
                                          }
                                          ?>
                                        </p>
                                      </div>
                                    </div>
                                  <?php } ?>
                                </div>
                                <!-- <div class="timeline">
                                  <div class="timeline-item right">
                                    <div class="timeline-content">
                                      <h3><i class="fas fa-check-circle icon"></i>Diterima PTSP</h3>
                                      <p>Berkas telah diterima oleh PTSP dan sedang dalam proses verifikasi awal.</p>
                                    </div>
                                  </div>

                                  <div class="timeline-item right">
                                    <div class="timeline-content">
                                      <h3><i class="fas fa-spinner icon"></i>Diproses Unit Pengelola</h3>
                                      <p>Berkas sedang dalam proses verifikasi oleh unit pengelola terkait.</p>
                                    </div>
                                  </div>

                                  <div class="timeline-item right">
                                    <div class="timeline-content">
                                      <h3><i class="fas fa-check icon"></i>Berkas Selesai</h3>
                                      <p>Berkas telah selesai diproses dan siap untuk diunduh.</p>
                                    </div>
                                  </div>
                                </div> -->
                              </td>
                            </tr>
                            <?php if ($value['status'] == 3) : ?>

                              <?php if ($value['penilaian'] == null) { ?>
                                <tr>
                                  <td>Berkas Jadi</td>
                                  <td>:
                                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
                                      Beri penilaian
                                    </button>
                                    <small>Beri penilaian sebelum mengunduh berkas</small>
                                  </td>
                                </tr>
                              <?php } else { ?>
                                <tr>
                                  <td>Berkas Jadi</td>
                                  <td>:
                                    <a href="<?= base_url('doc/keluar/') . $value['lampiran_jadi'] ?>" class="btn btn-primary btn-sm">Download</a>
                                  </td>
                                </tr>
                              <?php } ?>
                            <?php endif ?>
                          <?php endforeach; ?>
                        </tbody>
                      </table>
                    <?php else: ?>
                      <p>Tidak ada data yang ditemukan.</p>
                    <?php endif; ?>
                  </div>
                </div>
              <?php endif; ?>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-body">
          <?php if (isset($results)): ?>
            <?php foreach ($results as $key => $value): ?>
              <div class="row text-center">
                <h7>Silakan beri penilaian untuk pelayanan kami</h7>
              </div>


              <form action="/beranda/survey" method="post">
                <?= csrf_field(); ?>
                <input type="hidden" name="id" value="<?= $value['id']; ?>"> <!-- ID pelayanan yang dilacak -->
                <div class="row text-center">
                  <div class="star-rating">
                    <input type="radio" name="penilaian" value="1" id="star1" required><label for="star1" class="star">&#9733;</label>
                    <input type="radio" name="penilaian" value="2" id="star2"><label for="star2" class="star">&#9733;</label>
                    <input type="radio" name="penilaian" value="3" id="star3"><label for="star3" class="star">&#9733;</label>
                    <input type="radio" name="penilaian" value="4" id="star4"><label for="star4" class="star">&#9733;</label>
                    <input type="radio" name="penilaian" value="5" id="star5"><label for="star5" class="star">&#9733;</label>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm text-center">
                    <button type="submit" class="btn btn-primary btn-sm" style="height: fit-content; width:fit-content">Kirim Penilaian</button>
                  </div>
                </div>

              </form>
            <?php endforeach; ?>
          <?php endif; ?>
        </div>
      </div>
    </div>
  </div>
  <?php if (isset($error)): ?>
    <script>
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: '<?= esc($error) ?>',
      });
    </script>
  <?php endif; ?>
  <style>
    .star-rating {
      direction: rtl;
      display: inline-block;
    }

    .star-rating input[type="radio"] {
      display: none;
    }

    .star-rating label {
      font-size: 40px;
      color: #ddd;
      cursor: pointer;
    }

    .star-rating input[type="radio"]:checked~label {
      color: #ff9900;
      /* Warna bintang yang dipilih */
    }

    .star-rating label:hover,
    .star-rating label:hover~label {
      color: #ffcc00;
      /* Warna saat hover */
    }

    .star-rating input[type="radio"]:checked:hover~label {
      color: #ffcc00;
      /* Warna saat hover setelah memilih */
    }

    .modal-dialog {
      min-width: 200px;
      /* Ukuran minimal agar tidak terlalu kecil */
      max-width: 300px;
      /* Ukuran maksimal agar tidak terlalu besar */
      width: auto;
    }

    .timeline {
      position: relative;
      max-width: 600px;
      margin: auto;
    }

    .timeline::after {
      content: '';
      position: absolute;
      width: 4px;
      background-color: #017e3a;
      top: 0;
      bottom: 0;
      left: 20px;
      /* Posisikan ke kiri */
    }

    .timeline-item {
      position: relative;
      background-color: inherit;
      width: 50%;
      padding: 10px 40px;
      box-sizing: border-box;
    }

    .timeline-item {
      position: relative;
      background-color: inherit;
      width: 100%;
      /* Semua item di kiri */
      padding-left: 50px;
      /* Beri jarak dari garis */
      margin-bottom: 5px;
      box-sizing: border-box;
    }

    /* Lingkaran pada timeline */
    .timeline-item::after {
      content: '';
      position: absolute;
      top: 10px;
      left: 14px;
      /* Sejajarkan dengan garis timeline */
      width: 16px;
      height: 16px;
      background-color: #017e3a;
      border: 4px solid #017e3a;

      border-radius: 50%;
      z-index: 1;
    }

    /* Kotak isi timeline */
    .timeline-content {
      padding: 10px;
      background-color: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .timeline-content h3 {
      margin-top: 0;
      font-size: 14px;
    }

    .timeline-content p {
      font-size: 12px;
      color: #555;
    }

    .timeline-content .icon {
      font-size: 16px;
      color: #007bff;
      margin-right: 5px;
    }

    .nonactive {
      opacity: 0.5;
      /* Membuat elemen lebih transparan */
      filter: grayscale(50%);
      /* Mengurangi warna agar terlihat samar */
      transition: opacity 0.3s ease, filter 0.3s ease;
      /* Animasi efek */
    }
  </style>
</section>
<?= $this->endSection(); ?>